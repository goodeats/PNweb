<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:400,500,700,900">
<style>
.card-item {
  width: 50px;
  height: 80px;
  display: inline-block;
  position: relative;
  margin: 20px;
  margin-right: -30px;
  background: white;
  border: 1px solid black;
  border-radius: 10px;
  text-align: center;
  font: 1rem/1.175 "BlinkMacSystemFont", -apple-system, "Roboto", sans-serif;
}

.card-name--top,
.card-name--bottom {
  position: absolute;
  padding: 5px;
}

.card-name--top {
  top: 0;
  left: 0;
}

.card-name--bottom {
  bottom: 0;
  right: 0;
  transform: rotate(180deg);
}

.card-suit {
  line-height: 80px;
}


</style>


<script src="https://cdn.jsdelivr.net/npm/vue@2.5.16/dist/vue.js"></script>
<script>

Vue.component('card', {
  props: ['card'],
  template: `
    <li class="card-item">
      <span class="card-name--top">{{ pretty_card(card) }}</span>
      <span class="card-suit">{{ card.suit }}</span>
      <span class="card-name--bottom">{{ pretty_card(card) }} </span>
    </li>
  `,
  methods: {
    pretty_card: function(card){
      return card.name.toString().toUpperCase();
    }
  }
});

function suits(){
  return ['❤️','♠️','♦️','♣️'];
};

function cards_by_type(){
  var deck = [
    {name: 'a', value: 11, value_alt: 1},
    {name: 'k', value: 10},
    {name: 'q', value: 10},
    {name: 'j', value: 10}
  ];
  for (var i = 10; i > 1; i--){
    deck.push({name: i, value: i});
  }

  return deck;
};

function get_suits(cards){
  var deck = [];
  cards.forEach(function(card){
    suits().forEach(function(suit){
      var card_copy = JSON.parse(JSON.stringify(card));
      card_copy.suit = suit;
      deck = [...deck, card_copy];
    });
  });
  return deck;
}

function cards(){
  return get_suits(cards_by_type());
}

var app = new Vue({
  el: '#app',
  data: {
    message: 'Hi Pat!',
    cards: cards(),
    hands: [], // one player
    score: [0,0],
    game_status: 'Start the game!',
    game_started: false,
    game_over: false
  },
  methods: {
    shuffle: function(){
      return this.cards.sort((a, b) => Math.random() > .5 ? -1 : 1);
    },
    deal: function(){
      if (this.game_over) return;
      this.game_status = 'Playing the game';

      if (!this.game_started){
        this.game_started = true;
        this.deal_card();
      }

      this.deal_card();
    },
    deal_card: function(){
      var card = this.cards.shift();
      this.hands = [...this.hands, card];
      this.updateScore(card);
    },
    player_score: function(score){
      // check for ace
      var player_score = score[0];
      var player_score_alt = score[1];
      if (player_score > 21){
        this.game_status = 'You Lost :(';
        this.game_over = true;
      } else if (player_score === 21){
        this.game_status = 'You Won :D';
        this.game_over = true;
      }
      return player_score + " (or " + player_score_alt + ")";
    },
    updateScore: function(card){
      this.score[0] += card.value;
      this.score[1] += card.value_alt || card.value;
    }
  }
});
</script>
